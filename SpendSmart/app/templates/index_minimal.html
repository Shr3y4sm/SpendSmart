{% extends "base.html" %} {% block title %}Dashboard - SpendSmart{% endblock %}
{% block content %}
<!-- Page Header -->
<div class="page-header">
  <h1>Dashboard</h1>
  <p>Track your expenses and manage your budget</p>
</div>

<!-- Statistics Cards -->
<div class="stats-grid">
  <div class="stat-card">
    <span class="stat-label">Today</span>
    <div class="stat-value" id="todayTotal">₹0</div>
  </div>
  <div class="stat-card">
    <span class="stat-label">This Week</span>
    <div class="stat-value" id="weekTotal">₹0</div>
  </div>
  <div class="stat-card">
    <span class="stat-label">This Month</span>
    <div class="stat-value" id="monthTotal">₹0</div>
  </div>
  <div class="stat-card">
    <span class="stat-label">Total Expenses</span>
    <div class="stat-value" id="totalExpenses">0</div>
  </div>
</div>

<!-- Add Expense Form -->
<div class="card">
  <div class="card-header">
    <h3 class="card-title">Add Expense</h3>
  </div>

  <form id="expenseForm" class="grid grid-4">
    <div class="form-group">
      <label for="itemName" class="form-label">Item Name</label>
      <input
        type="text"
        class="form-control"
        id="itemName"
        placeholder="Coffee"
        required
      />
    </div>

    <div class="form-group">
      <label for="amount" class="form-label">Amount (₹)</label>
      <input
        type="number"
        class="form-control"
        id="amount"
        step="0.01"
        min="0"
        placeholder="150.00"
        required
      />
    </div>

    <div class="form-group">
      <label for="category" class="form-label">Category</label>
      <select class="form-select" id="category" required>
        <option value="">Select category</option>
        <option value="Food & Dining">Food & Dining</option>
        <option value="Transportation">Transportation</option>
        <option value="Shopping">Shopping</option>
        <option value="Entertainment">Entertainment</option>
        <option value="Bills & Utilities">Bills & Utilities</option>
        <option value="Healthcare">Healthcare</option>
        <option value="Education">Education</option>
        <option value="Others">Others</option>
      </select>
    </div>

    <div class="form-group">
      <label for="date" class="form-label">Date</label>
      <input type="date" class="form-control" id="date" required />
    </div>

    <div style="grid-column: span 4; display: flex; gap: 1rem">
      <button type="submit" class="btn btn-primary">Add Expense</button>
      <button type="button" class="btn btn-secondary" id="aiCategorizeBtn">
        Auto-categorize
      </button>
      <a href="{{ url_for('main.receipt_page') }}" class="btn btn-secondary"
        >Upload Receipt</a
      >
    </div>
  </form>
</div>

<!-- Budget Management -->
<div class="grid grid-2">
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">Set Budget</h3>
    </div>
    <form id="budgetForm">
      <div class="form-group">
        <label for="budgetAmount" class="form-label">Monthly Budget (₹)</label>
        <input
          type="number"
          class="form-control"
          id="budgetAmount"
          step="0.01"
          min="0"
          placeholder="5000.00"
          required
        />
      </div>
      <div class="form-group">
        <label for="budgetAlertThreshold" class="form-label"
          >Alert Threshold (%)</label
        >
        <input
          type="number"
          class="form-control"
          id="budgetAlertThreshold"
          min="50"
          max="100"
          value="80"
          required
        />
      </div>
      <button type="submit" class="btn btn-primary">Set Budget</button>
    </form>
  </div>

  <div class="card">
    <div class="card-header">
      <h3 class="card-title">Budget Status</h3>
    </div>
    <div id="budgetStatus">
      <p class="text-muted text-center" style="padding: 2rem">No budget set</p>
    </div>
  </div>
</div>

<!-- Chart Filters -->
<div class="card">
  <div class="card-header">
    <h3 class="card-title">Spending Trends</h3>
  </div>

  <div class="filter-group mb-4">
    <button class="filter-btn" data-period="week">Week</button>
    <button class="filter-btn active" data-period="month">Month</button>
    <button class="filter-btn" data-period="year">Year</button>
  </div>

  <div class="grid grid-2">
    <div>
      <canvas id="pieChart" style="max-height: 300px"></canvas>
    </div>
    <div>
      <canvas id="trendChart" style="max-height: 300px"></canvas>
    </div>
  </div>
</div>

<!-- Expenses Table -->
<div class="card">
  <div class="card-header">
    <h3 class="card-title">Recent Expenses</h3>
  </div>

  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Item</th>
          <th>Category</th>
          <th>Amount</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="expensesTableBody">
        <tr>
          <td colspan="5" class="text-center text-muted" style="padding: 2rem">
            No expenses yet
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Alert Container -->
<div
  id="alertContainer"
  style="position: fixed; top: 80px; right: 20px; z-index: 1000; width: 350px"
></div>

{% endblock %} {% block scripts %}
<script src="{{ url_for('static', filename='js/app.js') }}"></script>
<script src="{{ url_for('static', filename='js/charts.js') }}"></script>
<script src="{{ url_for('static', filename='js/budget.js') }}"></script>
<script src="{{ url_for('static', filename='js/edit.js') }}"></script>

<script>
  // Setup chart filters
  document.querySelectorAll(".filter-btn").forEach((btn) => {
    btn.addEventListener("click", () => {
      document
        .querySelectorAll(".filter-btn")
        .forEach((b) => b.classList.remove("active"));
      btn.classList.add("active");
      const period = btn.dataset.period;
      if (typeof updateVisualizations === "function") {
        updateVisualizations(period);
      }
    });
  });

  // Initialize charts
  if (typeof setupChartFilters === "function") {
    setupChartFilters();
  }

  // Initialize budget
  if (typeof initBudgetManagement === "function") {
    initBudgetManagement();
  }
</script>
{% endblock %}
