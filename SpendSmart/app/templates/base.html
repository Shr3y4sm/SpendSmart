<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}SpendSmart{% endblock %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}?v=3.1"
    />
    {% block head %}{% endblock %}
  </head>
  <body>
    <!-- Minimal Navigation -->
    <nav class="navbar">
      <div class="navbar-container">
        <a
          class="navbar-brand"
          href="{{ url_for('main.dashboard') if current_user.is_authenticated else url_for('main.login') }}"
        >
          <div class="brand-icon">
            <i class="bi bi-lightning-charge-fill"></i>
          </div>
          <span>SpendSmart</span>
        </a>

        {% if current_user.is_authenticated %}
        <ul class="navbar-nav">
          <li>
            <a class="nav-link active" href="{{ url_for('main.dashboard') }}">
              <i class="bi bi-speedometer2"></i>
              Dashboard
            </a>
          </li>
          <li>
            <button
              class="theme-toggle"
              onclick="toggleTheme()"
              aria-label="Toggle theme"
            >
              <i class="bi bi-moon-stars-fill theme-icon"></i>
            </button>
          </li>
          <li class="user-menu">
            <div class="dropdown">
              <div
                class="user-avatar"
                id="userMenuBtn"
                onclick="toggleDropdown()"
              >
                {{ current_user.username[0].upper() }}
              </div>
              <div class="dropdown-menu" id="userDropdown">
                <a class="dropdown-item" href="{{ url_for('main.profile') }}">
                  <i class="bi bi-person"></i>
                  Profile
                </a>
                <div class="dropdown-divider"></div>
                <a
                  class="dropdown-item logout-link"
                  href="{{ url_for('main.logout') }}"
                >
                  <i class="bi bi-box-arrow-right"></i>
                  Logout
                </a>
              </div>
            </div>
          </li>
        </ul>
        {% else %}
        <ul class="navbar-nav">
          <li>
            <button
              class="theme-toggle"
              onclick="toggleTheme()"
              aria-label="Toggle theme"
            >
              <i class="bi bi-moon-stars-fill theme-icon"></i>
            </button>
          </li>
          <li>
            <a class="nav-link" href="{{ url_for('main.login') }}">
              <i class="bi bi-box-arrow-in-right"></i>
              Login
            </a>
          </li>
          <li>
            <a class="btn btn-primary" href="{{ url_for('main.register') }}">
              Register
            </a>
          </li>
        </ul>
        {% endif %}
      </div>
    </nav>

    <!-- Main Content -->
    <main class="container">{% block content %}{% endblock %}</main>

    <!-- Minimal Footer -->
    <footer>
      <p>
        &copy; 2025 SpendSmart - Intelligent Expense Tracker &middot; Powered by
        AI
      </p>
    </footer>

    <!-- Dropdown Toggle Script -->
    <script>
      function toggleDropdown() {
        const dropdown = document.querySelector(".user-menu .dropdown");
        dropdown.classList.toggle("show");
      }

      // Close dropdown when clicking outside
      document.addEventListener("click", function (event) {
        const dropdown = document.querySelector(".user-menu .dropdown");
        const userBtn = document.getElementById("userMenuBtn");
        if (
          dropdown &&
          !dropdown.contains(event.target) &&
          event.target !== userBtn
        ) {
          dropdown.classList.remove("show");
        }

        // Close modals when clicking on overlay
        if (event.target.classList.contains("modal-overlay")) {
          event.target.style.display = "none";
        }
      });

      // Helper function to close edit modal
      function closeEditModal() {
        const modal = document.getElementById("editExpenseModal");
        if (modal) {
          modal.style.display = "none";
        }
      }

      // Theme Toggle Function
      function toggleTheme() {
        const html = document.documentElement;
        const currentTheme = html.getAttribute("data-theme");
        const newTheme = currentTheme === "dark" ? "light" : "dark";

        html.setAttribute("data-theme", newTheme);
        localStorage.setItem("theme", newTheme);

        // Update icon
        const icons = document.querySelectorAll(".theme-icon");
        icons.forEach((icon) => {
          if (newTheme === "dark") {
            icon.classList.remove("bi-moon-stars-fill");
            icon.classList.add("bi-sun-fill");
          } else {
            icon.classList.remove("bi-sun-fill");
            icon.classList.add("bi-moon-stars-fill");
          }
        });
      }

      // Load saved theme on page load (default to dark like SubTrackr)
      (function () {
        const savedTheme = localStorage.getItem("theme") || "dark";
        document.documentElement.setAttribute("data-theme", savedTheme);

        // Update icon based on saved theme
        const icons = document.querySelectorAll(".theme-icon");
        icons.forEach((icon) => {
          if (savedTheme === "dark") {
            icon.classList.remove("bi-moon-stars-fill");
            icon.classList.add("bi-sun-fill");
          }
        });
      })();
    </script>

    {% block scripts %}{% endblock %}
  </body>
</html>
